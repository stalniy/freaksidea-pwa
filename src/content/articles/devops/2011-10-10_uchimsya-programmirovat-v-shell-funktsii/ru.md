---
title: 'Учимся программировать в Shell: функции'
summary: |
  В Shell, как и в большинстве других языков программирования можно создавать
  функции, чтобы не повторять код или же просто для работы с более абстрактными
  понятиями. Посмотрим на них поближе
author: sstotskyi
categories:
  - devops
  - important
createdAt: 2011-10-10T11:36:00.000Z
meta:
  keywords:
    - linux
    - Bash
    - функции
alias: uchimsya-programmirovat-v-shell-funktsii
---

Если раньше о понятии "команда" мы говорили абстрактно, то сейчас, предстоит разобраться, что же это такое на самом деле. Команды бывают разных типов. Некоторые из них встроены в Shell, например **cd** и **pwd** (посмотреть список встроенных команд в Bash можно в мануале).

Другой тип команд - это встроенные программы. Большинство команд относится именно к этой группе. Эти программы хранятся в директориях, которые перечислены в переменной **$PATH**.

Последние две группы команд существуют только во время вашей рабочей сессии на протяжении которой, система хранит информацию о них в оперативной памяти. Эта информация также называется _рабочей средой_ (_environment_). Посмотреть весь список переменных рабочей среды можно при помощи команды **env**. Если нужно найти специфическую переменную, то можно перенаправить поток на команду **grep**

```bash
enej@linux:/home/pub/www/vv$ env | grep PATH
PATH=/home/enej/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/bin:/bin
```

В число этих 2 последних групп команд входят элиасы (aliases) и shell-функции.

## Aliases

Alias - это просто псевдоним для команды, обычно используется для удобства и краткости написания. Например, если Вам надоело писать **ls -l**, то можно создать alias с именем **lf** (ls full format)

```bash
enej@linux:~$ alias lf='ls -l'
enej@linux:~$ lf
total 4192
-rw-r--r--  1 enej enej   22049 2011-10-09 22:00 111.PNG
-rw-r--r--  1 enej enej 1089086 2011-10-09 13:24 all.rar
drwxr-xr-x  3 enej enej    4096 2011-07-04 19:45 bin
drwxr-xr-x  8 enej enej    4096 2011-05-01 10:44 Books
..........................................................
```

Чтобы вывести текущую дату в определенном формате (для этого используется команда **date**)

```bash
enej@linux:~$ alias today='date +"%A, %B %-d, %Y"'
enej@linux:~$ today
Monday, October 10, 2011
```

Таким образом Вы можете создать множество своих команд. Но не забывайте если Вы хотите, чтобы изменения сохранились при следующем входе в систему, то команды нужно прописать в один из файлов: **.bashrc** или **.bash\_profile**

## Shell функции

Псевдонимы (alias-ы) удобны для реализации простых команд. Но что если нужно скомбинировать работу нескольких команд и внедрить какую-то логику. Для этого используются shell функции. Например, давайте напишем ф-цию **today**, которая будет выводить текущую дату

```bash
function today {
    echo "Today's date is:"
    date +"%A, %B %-d, %Y"
}
```

Намного нагляднее и понятней, чем если бы это было сделано псевдонимом. Функции, также как и команды, могут принимать аргументы. Для этого в Bash существуют специальные переменные. Это относится как к написанным скриптам (файлам) так и к функциям.

Список всех аргументов переданных команде хранится в переменной **$@**. В переменной **$0** - хранится путь к файлу (команды), который запускается. Все остальные переменные вида **$1**, **$2**,..., **$n** - хранят в себе переданные по очереди аргументы. Чтобы убедится в этом, напишем простой скрипт

```bash
#!/bin/bash

function t() {
    echo '$0 in fn: ' $0;
    echo '$1 in fn: ' $1;
    echo '$2 in fn: ' $2;
}

echo 'All Script Args: ' $@;
echo '$0 = ' $0;
echo '$1 = ' $1;
echo '$2 = ' $2;
t 6 7 8;
```

Сохраним его в свою папку **bin**, установим права на выполнение и запустим с несколькими аргументами

```bash
enej@linux:~/bin$ ./test.sh 1 2 3
All Script Args:  1 2 3
$0 =  ./test.sh
$1 =  1
$2 =  2
$0 in fn:  ./test.sh
$1 in fn:  6
$2 in fn:  7
```

Как видим переменная **$0** глобальная для всего файла! Но другие аргументы находятся в области видимости команды. Если нужно передать все аргументы переданные в команду какой-то функции, то это можно сделать так

```bash
#!/bin/bash

function t() {
    echo '$0 in fn: ' $0;
    echo '$1 in fn: ' $1;
    echo '$2 in fn: ' $2;
}

echo 'All Script Args: ' $@;
echo '$0 = ' $0;
echo '$1 = ' $1;
echo '$2 = ' $2;
t $@;
```

Обратите внимание на последнюю строку - все аргументы переданные в файл **test.sh** передаются во внутреннюю функцию **t**.

**P.S.**: стоит обратить внимание, что переменные в одиночных кавычках (апострофах) не интерполируются. Для определения типа команды используйте **type command\_name**
