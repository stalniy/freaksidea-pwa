{"title":"Интеграция mobile friendly слайдера в Magento","summary":"Как-то раз работая над очередным мобильным приложением на ionic2, я\nиспользовал ion-slides, который как оказалось написан на основе другого open\nsource проекта - Swiper.io. С тех пор я его использую во всех проектах где\nнужен слайдер и сейчас расскажу почему.\n","author":"sstotskyi","categories":["frontend","important"],"createdAt":"2017-05-26T08:07:00.000Z","meta":{"keywords":["magento","javascript","оптимизация","swiper","mobile"]},"alias":"integratsiya-mobile-friendly-slajdera-v-magento","content":"<p><a href=\"http://idangero.us/swiper/#.WSZZ8SF96b9\" target=\"_blank\" rel=\"noopener nofollow\">Swiper.io</a> написан создателем <a href=\"https://framework7.io/\" target=\"_blank\" rel=\"noopener nofollow\">Framework7</a>. На гитхабе оба эти проекта имею 9000+ звезд, что очень хорошо (всего в 3 раза меньше чем <a href=\"http://ionicframework.com\" target=\"_blank\" rel=\"noopener nofollow\">ionic</a>). А автор сам из России поэтому можно гордится умами своей родины :) Погордились? Ну все давайте вернемся к делу.</p>\n<h2 id=\"znachit-swiper-zachem-on-mne\"><a name=\"znachit-swiper-zachem-on-mne\" class=\"h-link\" href=\"#\"></a>Значит swiper, зачем он мне?</h2>\n<p>Помните в Magento есть страничка продукта? Там есть рисунки продукта, которые можно и нужно просматривать. Magento по умолчанию предлагаю использовать scriptaculus slider и zoom из той же библиотеки, что не всегда подходит под современные требования. Поэтому существует множество lightbox модулей для просмотра рисунков. Один из таких модулей написал и я на базе библиотеки <a href=\"http://idangero.us/swiper/#.WSZZ8SF96b9\" target=\"_blank\" rel=\"noopener nofollow\">swiper.i</a>o.</p>\n<h2 id=\"pochemu-swiper-io\"><a name=\"pochemu-swiper-io\" class=\"h-link\" href=\"#\"></a>Почему Swiper.io?</h2>\n<p>Тут ответ достаточно очевиден:</p>\n<p>Во-первых, он мобайл фрэндли и позволяет пользователям на планшетах использовать их палец для перелистывания слайдов, что очень удобно.</p>\n<p>Во-вторых, он оптимизирован использовать минимальное количество ресурсов при перелистывании слайдов, за что пользователи скажут Вам спасибо, опять таки, потому что ничего не глючит.</p>\n<p>В-третих, в нем есть встроенная функция ленивое загрузки рисунков (рисунок загружается только в момент когда слайд стал виден).</p>\n<p>Если этот список не убедил Вас, рекомендую почитать список возможностей <a href=\"http://idangero.us/swiper/#.WSZaeCF96b-\" target=\"_blank\" rel=\"noopener nofollow\">на официальном сайте</a> и обязательно <a href=\"http://idangero.us/swiper/demos/\" target=\"_blank\" rel=\"noopener nofollow\">посмотрите демки</a>.</p>\n<p>Из минусов можно сказать, что он работает только с последними браузерами и весит 86кБ в минифицированном виде. Для меня это не было проблемой, так как я уже давно пишу под самые новые браузеры и IE11+. Если Вы до сих пор пишете под старые IE, то могу только посочувствовать :)</p>\n<h2 id=\"chto-v-konechnom-itoge\"><a name=\"chto-v-konechnom-itoge\" class=\"h-link\" href=\"#\"></a>Что в конечном итоге?</h2>\n<p>Для нетерпеливых вставлю скриншот того, что получится в конце.</p>\n<p><img src=\"/media/assets/magento-product-images-slides.png\" alt=\"Magento Product Images slides\" loading=\"lazy\" width=\"1182\" style=\"max-height: 606px;\" srcset=\"/media/assets/magento-product-images-slides-xs.png 375w,/media/assets/magento-product-images-slides-sm.png 768w,/media/assets/magento-product-images-slides-md.png 1024w,/media/assets/magento-product-images-slides.png 1280w\" sizes=\"(max-width: 375px) 375px,(max-width: 768px) 768px,(max-width: 1024px) 1024px,1280px\"></p>\n<p>Теперь перейдем к деталям.</p>\n<h2 id=\"podgotavlivaem-magento\"><a name=\"podgotavlivaem-magento\" class=\"h-link\" href=\"#\"></a>Подготавливаем Magento</h2>\n<p>Для начала нужно создать отдельную тему и отдельный skin. В теме я переопределю шаблон catalog/product/view/media.phtml и подключу swiper в local.xml, а в новом skin-е размещу дополнительные JavaScript файлы. Но сначала немного лирики об идеи для реализации :)</p>\n<p>В HTML5 появились data-* атрибуты, основная задача таких атрибутов - это передавать клиентские данные из сервера в клиентский код. Т.е., у нас есть swiper, который в разных местах, может иметь разные настройки и одну логику по инициализации. Вот эту самую идею data атрибутов я обычно использую не в Single Page Application-ах, потому что это позволяет писать структурный, widget-based код на jQuery.</p>\n<p>Для начала, положим исходники swiper-а (которые можно узнать как скачать <a href=\"http://idangero.us/swiper/get-started/#.WSZlJiF96b8\" target=\"_blank\" rel=\"noopener nofollow\">здесь</a>) в директорию skin/frontend/slides/vendor/swiper. Здесь будут находится и CSS файлы и JavaScript файлы этой библиотеки. Также нам понадобятся jquery.3.1.slim и 2 JavaScript файла из библиотеки <a href=\"http://getbootstrap.com/\" target=\"_blank\" rel=\"noopener nofollow\">bootstrap 3.x</a>: transition.js и modal.js. Дополнительно добавлю пустой файл в skin/frontend/slides/js/media_modal.js, где потом и напишу логику отвечающую за открытие swiper-a в модальном окне.</p>\n<p>После изменений мой local.xml выглядит вот так:</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">layout</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">\"0.1.0\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">default</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">reference</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"head\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"removeItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>scriptaculous/slider.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>vendor/jquery.3.1.slim.min.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>vendor/swiper/js/swiper.jquery.min.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>vendor/bootstrap/transition.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>vendor/bootstrap/modal.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>js/media_modal.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">reference</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">default</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">layout</span>&gt;</span>\n</code></pre>\n<p>Теперь нужно скопировать себе в тему файл app/design/frontend/base/catalog/product/view/media.phtml -&gt; app/design/frontend/swiper/catalog/product/view/media.phtml и добавить data атрибуты в на все картинки, вот так:</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-meta\">&lt;?php</span>\n  $product = <span class=\"hljs-keyword\">$this</span>-&gt;getProduct();\n  $output = <span class=\"hljs-keyword\">$this</span>-&gt;helper(<span class=\"hljs-string\">'catalog/output'</span>);\n  $baseImageIndex = <span class=\"hljs-number\">0</span>;\n  $baseImage = $product-&gt;getImage();\n  $index = <span class=\"hljs-number\">0</span>;\n\n  <span class=\"hljs-keyword\">foreach</span> (<span class=\"hljs-keyword\">$this</span>-&gt;getGalleryImages() <span class=\"hljs-keyword\">as</span> $image) {\n    <span class=\"hljs-keyword\">if</span> ($image-&gt;getFile() === $baseImage) {\n      $baseImageIndex = $index;\n      <span class=\"hljs-keyword\">break</span>;\n    }\n\n    $index++;\n  }\n<span class=\"hljs-meta\">?&gt;</span>\n&lt;div data-widget=<span class=\"hljs-string\">\"mediaModal\"</span>&gt;\n  &lt;div <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span>=\"<span class=\"hljs-title\">photo</span>-<span class=\"hljs-title\">product</span> <span class=\"hljs-title\">product</span>-<span class=\"hljs-title\">image</span>\" <span class=\"hljs-title\">data</span>-<span class=\"hljs-title\">item</span> <span class=\"hljs-title\">data</span>-<span class=\"hljs-title\">index</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">baseImageIndex</span> ?&gt;\"&gt;\n    &lt;<span class=\"hljs-title\">div</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">product</span>-<span class=\"hljs-title\">hints</span>\"&gt;\n      &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">if</span> ($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">helper</span>('<span class=\"hljs-title\">freaks_ruba4ok</span>')-&gt;<span class=\"hljs-title\">isBestseller</span>($<span class=\"hljs-title\">product</span>)): ?&gt;\n      &lt;<span class=\"hljs-title\">i</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">icon</span> <span class=\"hljs-title\">icon</span>-<span class=\"hljs-title\">bestseller</span>\" <span class=\"hljs-title\">title</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">__</span>('<span class=\"hljs-title\">Bestseller</span>') ?&gt;\"&gt;&lt;/<span class=\"hljs-title\">i</span>&gt;\n      &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">endif</span> ?&gt;\n      &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">if</span> ($<span class=\"hljs-title\">product</span>-&gt;<span class=\"hljs-title\">getFinalPrice</span>() &lt; $<span class=\"hljs-title\">product</span>-&gt;<span class=\"hljs-title\">getPrice</span>()): ?&gt;\n      &lt;<span class=\"hljs-title\">i</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">icon</span> <span class=\"hljs-title\">icon</span>-<span class=\"hljs-title\">discount</span>\" <span class=\"hljs-title\">title</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">__</span>('<span class=\"hljs-title\">Discount</span>') ?&gt;\"&gt;&lt;/<span class=\"hljs-title\">i</span>&gt;\n      &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">endif</span> ?&gt;\n    &lt;/<span class=\"hljs-title\">div</span>&gt;\n    &lt;?<span class=\"hljs-title\">php</span>\n      $<span class=\"hljs-title\">_img</span> = '&lt;<span class=\"hljs-title\">img</span> <span class=\"hljs-title\">id</span>=\"<span class=\"hljs-title\">image</span>\" <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">basic</span>-<span class=\"hljs-title\">img</span>\" <span class=\"hljs-title\">src</span>=\"'.$<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">helper</span>('<span class=\"hljs-title\">catalog</span>/<span class=\"hljs-title\">image</span>')-&gt;<span class=\"hljs-title\">init</span>($<span class=\"hljs-title\">product</span>, '<span class=\"hljs-title\">image</span>').'\" <span class=\"hljs-title\">alt</span>=\"'.$<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">escapeHtml</span>($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">getImageLabel</span>()).'\" <span class=\"hljs-title\">title</span>=\"'.$<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">escapeHtml</span>($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">getImageLabel</span>()).'\" /&gt;';\n      <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">output</span>-&gt;<span class=\"hljs-title\">productAttribute</span>($<span class=\"hljs-title\">product</span>, $<span class=\"hljs-title\">_img</span>, '<span class=\"hljs-title\">image</span>');\n    ?&gt;\n  &lt;/<span class=\"hljs-title\">div</span>&gt;\n  &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">if</span> (<span class=\"hljs-title\">count</span>($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">getGalleryImages</span>()) &gt; 0): ?&gt;\n    &lt;<span class=\"hljs-title\">div</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">other</span>-<span class=\"hljs-title\">photos</span>\"&gt;\n    &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">foreach</span> ($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">getGalleryImages</span>() <span class=\"hljs-title\">as</span> $<span class=\"hljs-title\">_image</span>): ?&gt;\n      &lt;?<span class=\"hljs-title\">php</span> $<span class=\"hljs-title\">originalImageUrl</span> = $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">helper</span>('<span class=\"hljs-title\">catalog</span>/<span class=\"hljs-title\">image</span>')-&gt;<span class=\"hljs-title\">init</span>($<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">getProduct</span>(), '<span class=\"hljs-title\">thumbnail</span>', $<span class=\"hljs-title\">_image</span>-&gt;<span class=\"hljs-title\">getFile</span>()) ?&gt;\n      &lt;<span class=\"hljs-title\">div</span> <span class=\"hljs-title\">class</span>=\"<span class=\"hljs-title\">clip</span>-<span class=\"hljs-title\">img</span>\" <span class=\"hljs-title\">data</span>-<span class=\"hljs-title\">item</span> <span class=\"hljs-title\">data</span>-<span class=\"hljs-title\">url</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">originalImageUrl</span> ?&gt;\" <span class=\"hljs-title\">title</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">escapeHtml</span>($<span class=\"hljs-title\">_image</span>-&gt;<span class=\"hljs-title\">getLabel</span>()) ?&gt;\"&gt;\n        &lt;<span class=\"hljs-title\">img</span> <span class=\"hljs-title\">src</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">helper</span>('<span class=\"hljs-title\">catalog</span>/<span class=\"hljs-title\">image</span>')-&gt;<span class=\"hljs-title\">init</span>($<span class=\"hljs-title\">product</span>, '<span class=\"hljs-title\">thumbnail</span>', $<span class=\"hljs-title\">_image</span>-&gt;<span class=\"hljs-title\">getFile</span>())-&gt;<span class=\"hljs-title\">resize</span>(100); ?&gt;\" <span class=\"hljs-title\">alt</span>=\"&lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">echo</span> $<span class=\"hljs-title\">this</span>-&gt;<span class=\"hljs-title\">escapeHtml</span>($<span class=\"hljs-title\">_image</span>-&gt;<span class=\"hljs-title\">getLabel</span>()) ?&gt;\" /&gt;\n      &lt;/<span class=\"hljs-title\">div</span>&gt;\n    &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">endforeach</span> ?&gt;\n    &lt;/<span class=\"hljs-title\">div</span>&gt;\n  &lt;?<span class=\"hljs-title\">php</span> <span class=\"hljs-title\">endif</span> ?&gt;\n&lt;/<span class=\"hljs-title\">div</span>&gt;\n</span></code></pre>\n<p>Давайте теперь разберем где и зачем добавлены атрибуты.</p>\n<p>Во-первых, самый важный атрибут - это data-widget=&quot;mediaModal&quot;, именно по нему я буду находить все элементы, к которым нужно применить мой слайдер. Во-вторых, атрибуты data-item указывают непосредственно на нахождение картинок внутри нашего виджета. Каждый data-item должен иметь data-url атрибут, который содержит URL на большую картинку или же data-index атрибут, который содержит порядковый номер рисунка внутри списка. Именно поэтому, вверху шаблона, я искал индекс большого рисунка.</p>\n<p>JavaScript готов, шаблон тоже подготовлен, давайте добавим еще css прежде чем начинать. В local.xml добавляю CSS для модалки и swiper-a</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-comment\">&lt;!-- ... --&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>js/widget/media_modal.js<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_css<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>vendor/swiper/css/swiper.min.css<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"addItem\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>skin_css<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>css/modal.css<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">params</span>/&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n<span class=\"hljs-comment\">&lt;!-- ... --&gt;</span>\n</code></pre>\n<p>css/modal.css я вырезал из соответствующего <a href=\"https://github.com/twbs/bootstrap-sass/blob/v3.3.7/assets/stylesheets/bootstrap/_modals.scss\" target=\"_blank\" rel=\"noopener nofollow\">файла в bootstrap на github-е</a> и упростил его, SCSS аналог должен выглядеть вот так:</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.fade</span> {\n  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">transition</span>: opacity .<span class=\"hljs-number\">15s</span> linear;\n}\n\n<span class=\"hljs-selector-class\">.in</span> {\n  <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">1</span>;\n}\n\n<span class=\"hljs-selector-class\">.modal-open</span> {\n  <span class=\"hljs-attribute\">overflow</span>: hidden;\n\n  .modal {\n    <span class=\"hljs-attribute\">overflow-x</span>: hidden;\n    <span class=\"hljs-attribute\">overflow-y</span>: auto;\n  }\n}\n\n<span class=\"hljs-selector-class\">.modal</span> {\n  <span class=\"hljs-attribute\">position</span>: fixed;\n  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">bottom</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">10001</span>;\n  <span class=\"hljs-attribute\">display</span>: none;\n  <span class=\"hljs-attribute\">overflow</span>: hidden;\n\n  &amp;.fade .modal-dialog {\n    <span class=\"hljs-attribute\">transition</span>: transform .<span class=\"hljs-number\">2s</span> ease-out;\n    <span class=\"hljs-attribute\">transform</span>: <span class=\"hljs-built_in\">translate</span>(<span class=\"hljs-number\">0</span>, -<span class=\"hljs-number\">50%</span>);\n  }\n  &amp;<span class=\"hljs-selector-class\">.in</span> <span class=\"hljs-selector-class\">.modal-dialog</span> { <span class=\"hljs-attribute\">transform</span>: <span class=\"hljs-built_in\">translate</span>(<span class=\"hljs-number\">0</span>, <span class=\"hljs-number\">0</span>); }\n\n  &amp;<span class=\"hljs-selector-tag\">-dialog</span> {\n    <span class=\"hljs-attribute\">position</span>: relative;\n    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">30px</span> auto;\n  }\n\n  &amp;<span class=\"hljs-selector-tag\">-scrollbar-measure</span> {\n    <span class=\"hljs-attribute\">position</span>: absolute;\n    <span class=\"hljs-attribute\">top</span>: -<span class=\"hljs-number\">9999px</span>;\n    <span class=\"hljs-attribute\">width</span>: <span class=\"hljs-number\">50px</span>;\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">50px</span>;\n    <span class=\"hljs-attribute\">overflow</span>: scroll;\n  }\n}\n\n<span class=\"hljs-selector-class\">.modal-backdrop</span> {\n  <span class=\"hljs-attribute\">position</span>: fixed;\n  <span class=\"hljs-attribute\">top</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">bottom</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">left</span>: <span class=\"hljs-number\">0</span>;\n  <span class=\"hljs-attribute\">background-color</span>: <span class=\"hljs-built_in\">map-get</span>($colors, opacity-bg);\n  <span class=\"hljs-attribute\">opacity</span>: .<span class=\"hljs-number\">55</span>;\n  <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">3000</span>;\n\n  &amp;.fade {\n    <span class=\"hljs-attribute\">opacity</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">transition</span>: opacity .<span class=\"hljs-number\">15s</span> linear;\n  }\n\n  &amp;<span class=\"hljs-selector-class\">.in</span> {\n    <span class=\"hljs-attribute\">opacity</span>: .<span class=\"hljs-number\">55</span>;\n  }\n}\n\n<span class=\"hljs-selector-class\">.pure-modal</span> {\n  .modal-dialog {\n    <span class=\"hljs-attribute\">margin</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;\n  }\n\n  <span class=\"hljs-selector-class\">.btn-close</span> {\n    <span class=\"hljs-attribute\">position</span>: absolute;\n    <span class=\"hljs-attribute\">right</span>: <span class=\"hljs-number\">0</span>;\n    <span class=\"hljs-attribute\">z-index</span>: <span class=\"hljs-number\">100</span>;\n  }\n\n  <span class=\"hljs-selector-class\">.modal-dialog</span> {\n    <span class=\"hljs-attribute\">text-align</span>: center;\n  }\n\n  <span class=\"hljs-selector-class\">.modal-content</span> {\n    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-number\">#fff</span>;\n    <span class=\"hljs-attribute\">background</span>: <span class=\"hljs-built_in\">rgba</span>(<span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">255</span>, <span class=\"hljs-number\">0.4</span>);\n  }\n}\n</code></pre>\n<p>Дополнительно я добавил класс pure-modal - он растягивает модалку на весь экран и ставит прозрачный background на контент.</p>\n<h2 id=\"vnedrenie-swiper-io\"><a name=\"vnedrenie-swiper-io\" class=\"h-link\" href=\"#\"></a>Внедрение Swiper.io</h2>\n<p>Пришло время добавить код в файл media_modal.js. Самое главное - это нужно вызвать noConflict в jQuery, иначе половина сайта не будет работать, так как jQuery может конфликтовать с библиотекой Prototype.js. И сразу же добавлю стандартный шаблон для модального окна, которое в конечно итоге будет отображаться пользователю</p>\n<pre><code class=\"hljs language-javascript\">jQuery.noConflict();\njQuery(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>) </span>{\n  <span class=\"hljs-keyword\">var</span> $template = $([\n    <span class=\"hljs-string\">'&lt;div class=\"modal pure-modal fade\" tabindex=\"-1\"&gt;'</span>,\n      <span class=\"hljs-string\">'&lt;div class=\"modal-dialog\"&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;button type=\"button\" class=\"btn btn-close\" data-dismiss=\"modal\"&gt;×&lt;/button&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;div class=\"swiper-container full-height modal-content\"&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-wrapper\"&gt;&lt;/div&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-button-next\"&gt;&lt;/div&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-button-prev\"&gt;&lt;/div&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;/div&gt;'</span>,\n      <span class=\"hljs-string\">'&lt;/div&gt;'</span>,\n    <span class=\"hljs-string\">'&lt;/div&gt;'</span>\n  ].join(<span class=\"hljs-string\">''</span>));\n})\n</code></pre>\n<p>Обычная модалка, со стандартным шаблоном для swiper-a, но обратите внимание на модальном окне стоит дополнительно класс pure-modal и на swiper-container стоит класс full-height. pure-modal я уже описал выше, а full-height для swiper-a выглядит вот так:</p>\n<pre><code class=\"hljs language-css\"><span class=\"hljs-selector-class\">.swiper-container</span><span class=\"hljs-selector-class\">.full-height</span> {\n  <span class=\"hljs-attribute\">height</span>: <span class=\"hljs-number\">100%</span>;\n\n  .swiper-slide {\n    <span class=\"hljs-attribute\">display</span>: flex;\n    <span class=\"hljs-attribute\">align-items</span>: center;\n    <span class=\"hljs-attribute\">justify-content</span>: center;\n    <span class=\"hljs-attribute\">background</span>: transparent;\n  }\n\n  <span class=\"hljs-selector-tag\">img</span> {\n    <span class=\"hljs-attribute\">max-height</span>: <span class=\"hljs-number\">100%</span>;\n    <span class=\"hljs-attribute\">max-width</span>: <span class=\"hljs-number\">100%</span>;\n  }\n}\n</code></pre>\n<p>Теперь нужно найти все элементы на странице с атрибутом data-widget=&quot;mediaModal&quot; и добавить обработчик на событие click по элементам с data-item атрибутом. По клику на любой из таких элементов (которые по сути являются картинками), нужно отрисовать слайды для swiper-a, инициализировать свайпер, вставить модалку в тэг body и перелистать свайпер к элементу на который нажал пользователь.</p>\n<p>Все вместе выглядит вот так:</p>\n<pre><code class=\"hljs language-javascript\">jQuery(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$</span>) </span>{\n  <span class=\"hljs-keyword\">var</span> $template = $([\n    <span class=\"hljs-string\">'&lt;div class=\"modal pure-modal fade\" tabindex=\"-1\"&gt;'</span>,\n      <span class=\"hljs-string\">'&lt;div class=\"modal-dialog\"&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;button type=\"button\" class=\"btn btn-close\" data-dismiss=\"modal\"&gt;×&lt;/button&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;div class=\"swiper-container full-height modal-content\"&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-wrapper\"&gt;&lt;/div&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-button-next\"&gt;&lt;/div&gt;'</span>,\n          <span class=\"hljs-string\">'&lt;div class=\"swiper-button-prev\"&gt;&lt;/div&gt;'</span>,\n        <span class=\"hljs-string\">'&lt;/div&gt;'</span>,\n      <span class=\"hljs-string\">'&lt;/div&gt;'</span>,\n    <span class=\"hljs-string\">'&lt;/div&gt;'</span>\n  ].join(<span class=\"hljs-string\">''</span>));\n\n  $(<span class=\"hljs-string\">'[data-widget=mediaModal]'</span>).on(<span class=\"hljs-string\">'click'</span>, <span class=\"hljs-string\">'[data-item]'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">e</span>) </span>{\n    e.preventDefault();\n    <span class=\"hljs-keyword\">var</span> $modal = $template.clone(<span class=\"hljs-literal\">true</span>);\n    <span class=\"hljs-keyword\">var</span> $swiper = $modal.find(<span class=\"hljs-string\">'.swiper-wrapper'</span>);\n    <span class=\"hljs-keyword\">var</span> $clickedItem = $(e.currentTarget);\n\n    $(e.delegateTarget).find(<span class=\"hljs-string\">'[data-item]'</span>).each(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">i, element</span>) </span>{\n      <span class=\"hljs-keyword\">var</span> $item = $(element);\n\n      <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">typeof</span> $item.data(<span class=\"hljs-string\">'index'</span>) === <span class=\"hljs-string\">'undefined'</span>) {\n        renderSlideItem($(element)).appendTo($swiper);\n      }\n    });\n\n    <span class=\"hljs-keyword\">var</span> swiper = createSwiper($swiper.parent());\n    $modal.appendTo(<span class=\"hljs-string\">'body'</span>)\n      .modal({ <span class=\"hljs-attr\">keyboard</span>: <span class=\"hljs-literal\">true</span> })\n      .one(<span class=\"hljs-string\">'hidden.bs.modal'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n        $modal.remove();\n      })\n      .one(<span class=\"hljs-string\">'shown.bs.modal'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n        swiper.update();\n        swiper.slideTo($clickedItem.data(<span class=\"hljs-string\">'index'</span>) || $clickedItem.index());\n      });\n  });\n\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">renderSlideItem</span>(<span class=\"hljs-params\">$mediaItem</span>) </span>{\n    <span class=\"hljs-keyword\">var</span> $slide = $(<span class=\"hljs-string\">'&lt;div class=\"swiper-slide\"&gt;&lt;/div&gt;'</span>);\n\n    <span class=\"hljs-keyword\">return</span> $slide.append(<span class=\"hljs-string\">'&lt;img class=\"swiper-lazy\" data-src=\"'</span> + $mediaItem.data(<span class=\"hljs-string\">'url'</span>) + <span class=\"hljs-string\">'\" /&gt;'</span>);\n  }\n\n  <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">createSwiper</span>(<span class=\"hljs-params\">$container</span>) </span>{\n    <span class=\"hljs-keyword\">var</span> $buttons = $container.find(<span class=\"hljs-string\">'.swiper-button-next, .swiper-button-prev'</span>);\n    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> Swiper($container[<span class=\"hljs-number\">0</span>], {\n      <span class=\"hljs-attr\">nextButton</span>: $buttons[<span class=\"hljs-number\">0</span>],\n      <span class=\"hljs-attr\">prevButton</span>: $buttons[<span class=\"hljs-number\">1</span>],\n      <span class=\"hljs-attr\">spaceBetween</span>: <span class=\"hljs-number\">30</span>,\n      <span class=\"hljs-attr\">preloadImages</span>: <span class=\"hljs-literal\">false</span>,\n      <span class=\"hljs-attr\">lazyLoading</span>: <span class=\"hljs-literal\">true</span>,\n      <span class=\"hljs-attr\">lazyLoadingOnTransitionStart</span>: <span class=\"hljs-literal\">true</span>,\n      <span class=\"hljs-attr\">keyboardControl</span>: <span class=\"hljs-literal\">true</span>,\n    });\n  }\n});\n</code></pre>\n<p>После сохранение и обновления кэша Вы получите ожидаемый результат, который удобный как для пользователей ПК так и для пользователей планшетов и других мобильных устройств :)</p>","headings":[["znachit-swiper-zachem-on-mne","Значит swiper, зачем он мне?"],["pochemu-swiper-io","Почему Swiper.io?"],["chto-v-konechnom-itoge","Что в конечном итоге?"],["podgotavlivaem-magento","Подготавливаем Magento"],["vnedrenie-swiper-io","Внедрение Swiper.io"]],"id":"integratsiya-mobile-friendly-slajdera-v-magento"}