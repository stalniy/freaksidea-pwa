{"title":"Блоки. Как вывести список всех новинок или спец. предложений в Magento","summary":"В любом интернет-магазине есть блоки с выводом нескольких новинок, спец.\nпредложений, мы рекомендуем, etc. Попробуем закрыть эту проблему в Magento\n","author":"sstotskyi","categories":["backend"],"createdAt":"2011-10-03T13:56:00.000Z","meta":{"keywords":["magento","блоки","новинки"]},"alias":"bloki-kak-vyvesti-spisok-vsekh-novinok-ili-spets-predlozhenij-v-magento","content":"<p>Интернет магазин без новинок или спец. предложений - это уже не магазин. Как минимум посетители будут не довольны отсутствием такого функционала, как максимум их будет не много, что подтверждает недавняя практика.</p>\n<p>Работая последнее время с Magento мне пришлось реализовать удобный для себя функционал вывода блоков и страниц (с возможностью фильтрации) коллекции продуктов. Достаточно странно, что этого нет в стандартном функционале (нашел только новые продукты в виджетах).</p>\n<h2 id=\"bloki-kirpichik-k-kirpichiku\"><a name=\"bloki-kirpichik-k-kirpichiku\" class=\"h-link\" href=\"#\"></a>Блоки. Кирпичик к кирпичику</h2>\n<p>Немного поразмыслив можно прийти к заключению, что на сайте нужны такие типы блоков для продуктов:</p>\n<ul>\n<li>новинки</li>\n<li>последние</li>\n<li>спец. предложения</li>\n<li>с определенным флагом, например, featured</li>\n</ul>\n<p>Все начинается из <app-link to=\"backend\" params=\"{&quot;id&quot;:&quot;magento-sozdanie-crud-modulya&quot;}\">создания стандартного модуля Magento</app-link>... Поскольку код подразумевает выборку товаров (з кучей атрибутов и прочего всего), то обязательно нужно использовать механизм кэширования. Реализация его в Magento выглядит следующим образом</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-keyword\">protected</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">_construct</span><span class=\"hljs-params\">()</span>\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;addData(<span class=\"hljs-keyword\">array</span>(\n            <span class=\"hljs-string\">'cache_lifetime'</span>    =&gt; <span class=\"hljs-number\">86400</span>,\n            <span class=\"hljs-string\">'cache_tags'</span>        =&gt; <span class=\"hljs-keyword\">array</span>(Mage_Catalog_Model_Product::CACHE_TAG),\n        ));\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getCacheKeyInfo</span><span class=\"hljs-params\">()</span>\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">array</span>(\n           <span class=\"hljs-string\">'CATALOG_PRODUCT_SPECIALS_AND_NEW'</span>,\n           Mage::app()-&gt;getStore()-&gt;getId(),\n           Mage::getDesign()-&gt;getPackageName(),\n           Mage::getDesign()-&gt;getTheme(<span class=\"hljs-string\">'template'</span>),\n           Mage::getSingleton(<span class=\"hljs-string\">'customer/session'</span>)-&gt;getCustomerGroupId(),\n           <span class=\"hljs-string\">'template'</span> =&gt; <span class=\"hljs-keyword\">$this</span>-&gt;getTemplate(),\n           <span class=\"hljs-keyword\">$this</span>-&gt;getProductsCount(),\n           <span class=\"hljs-keyword\">$this</span>-&gt;getType()\n        );\n    }\n}\n</code></pre>\n<p>В конструкторе указываем, что время жизни кэша, в конкретном случае дня, вполне будет достаточно. Также указываем кэш теги, по которым можно достать кэшированый блок. Метод <strong>getCacheKeyInfo</strong> ответственный за уникальность ключа кэша. В нем определяются все зависимости сохраненных данных, т.е. если один из этих параметров будет другим, то вместо использования старой версии будет создана новая. Например, видно, что кэш будет уникальным для каждого магазина (Magento store), для каждой темы, к-ва выводимых продуктов и шаблона для блока.</p>\n<p>Полезным и правильным будет создать возможность указания к-ва выводимых продуктов через layout-ы. Для этого сделаем простые геттеры/сеттеры для свойства <strong>$_productCount</strong>, а также добавим константу <strong>DEFAULT_PRODUCTS_COUNT</strong></p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-keyword\">const</span> DEFAULT_PRODUCTS_COUNT = <span class=\"hljs-number\">3</span>;\n\n    <span class=\"hljs-keyword\">protected</span>\n        $_productCollection,\n        $_productsCount;\n\n    <span class=\"hljs-comment\">/**\n     * Set how much product should be displayed at once.\n     *\n     * <span class=\"hljs-doctag\">@param</span> $count\n     * <span class=\"hljs-doctag\">@return</span> Freaks_Products_Block_Region\n     */</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">setProductsCount</span><span class=\"hljs-params\">($count)</span>\n    </span>{\n        <span class=\"hljs-keyword\">$this</span>-&gt;_productsCount = $count;\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>;\n    }\n\n    <span class=\"hljs-comment\">/**\n     * Get how much products should be displayed at once.\n     *\n     * <span class=\"hljs-doctag\">@return</span> int\n     */</span>\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getProductsCount</span><span class=\"hljs-params\">()</span>\n    </span>{\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> === <span class=\"hljs-keyword\">$this</span>-&gt;_productsCount) {\n            <span class=\"hljs-keyword\">$this</span>-&gt;_productsCount = <span class=\"hljs-keyword\">self</span>::DEFAULT_PRODUCTS_COUNT;\n        }\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;_productsCount;\n    }\n\n    <span class=\"hljs-comment\">// some another methods</span>\n}\n</code></pre>\n<p>Ну а теперь самое интересное. Реализуем методы для выборки продуктов. Но для начала нужно сделать метод который будет возвращать базовою коллекцию продуктов, к которой потом можно будет применить дополнительные фильтры.</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getProductCollection</span><span class=\"hljs-params\">()</span>\n    </span>{\n        $categoryId = Mage::app()-&gt;getStore()-&gt;getRootCategoryId();\n        <span class=\"hljs-keyword\">$this</span>-&gt;_productCollection = Mage::getResourceModel(<span class=\"hljs-string\">'catalog/product_collection'</span>)\n            -&gt;setStoreId(Mage::app()-&gt;getStore()-&gt;getId())\n            -&gt;addAttributeToSelect(Mage::getSingleton(<span class=\"hljs-string\">'catalog/config'</span>)-&gt;getProductAttributes())\n            -&gt;addMinimalPrice()\n            -&gt;addFinalPrice()\n            -&gt;addTaxPercents()\n            -&gt;addUrlRewrite($categoryId);\n        Mage::getSingleton(<span class=\"hljs-string\">'catalog/product_status'</span>)-&gt;addVisibleFilterToCollection(<span class=\"hljs-keyword\">$this</span>-&gt;_productCollection);\n        Mage::getSingleton(<span class=\"hljs-string\">'catalog/product_visibility'</span>)-&gt;addVisibleInSearchFilterToCollection(<span class=\"hljs-keyword\">$this</span>-&gt;_productCollection);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;_productCollection;\n    }\n}\n</code></pre>\n<p>Как видно по коду данный метод добавляет нужные атрибуты и фильтры, как например фильтр по видимости и статусу.</p>\n<p>Добавим еще один полезный метод, который в зависимости от типа блока, который можно установить через layout-update, будет возвращать нужную коллекцию продуктов</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getProducts</span><span class=\"hljs-params\">()</span>\n    </span>{\n        $type = <span class=\"hljs-keyword\">$this</span>-&gt;getType();\n        <span class=\"hljs-keyword\">if</span> (!$type) {\n            Mage::throwException(<span class=\"hljs-keyword\">$this</span>-&gt;__(<span class=\"hljs-string\">'Products block type must be specified'</span>));\n        }\n\n        $method = <span class=\"hljs-string\">'get'</span> . ucfirst(strtolower($type)) . <span class=\"hljs-string\">'Products'</span>;\n        <span class=\"hljs-keyword\">if</span> (!method_exists(<span class=\"hljs-keyword\">$this</span>, $method)) {\n            Mage::throwException(<span class=\"hljs-keyword\">$this</span>-&gt;__(<span class=\"hljs-string\">'Unknown products block type'</span>));\n        }\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;$method();\n    }\n}\n</code></pre>\n<p>Теперь посмотрим на код каждого из типов блоков.</p>\n<h4 id=\"novinki\"><a name=\"novinki\" class=\"h-link\" href=\"#\"></a>Новинки</h4>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getNewProducts</span><span class=\"hljs-params\">()</span>\n    </span>{\n        $todayDate  = Mage::app()-&gt;getLocale()-&gt;date()\n            -&gt;toString(Varien_Date::DATETIME_INTERNAL_FORMAT);\n\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;getProductCollection()\n            -&gt;addAttributeToFilter(<span class=\"hljs-string\">'news_from_date'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'or'</span> =&gt; <span class=\"hljs-keyword\">array</span>(\n                <span class=\"hljs-number\">0</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'date'</span> =&gt; <span class=\"hljs-keyword\">true</span>, <span class=\"hljs-string\">'to'</span> =&gt; $todayDate),\n                <span class=\"hljs-number\">1</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'is'</span> =&gt; <span class=\"hljs-keyword\">new</span> Zend_Db_Expr(<span class=\"hljs-string\">'null'</span>)))\n            ), <span class=\"hljs-string\">'left'</span>)\n            -&gt;addAttributeToFilter(<span class=\"hljs-string\">'news_to_date'</span>, <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'or'</span> =&gt; <span class=\"hljs-keyword\">array</span>(\n                <span class=\"hljs-number\">0</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'date'</span> =&gt; <span class=\"hljs-keyword\">true</span>, <span class=\"hljs-string\">'from'</span> =&gt; $todayDate),\n                <span class=\"hljs-number\">1</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'is'</span> =&gt; <span class=\"hljs-keyword\">new</span> Zend_Db_Expr(<span class=\"hljs-string\">'null'</span>)))\n            ), <span class=\"hljs-string\">'left'</span>)\n            -&gt;addAttributeToFilter(<span class=\"hljs-keyword\">array</span>(\n                <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'attribute'</span> =&gt; <span class=\"hljs-string\">'news_from_date'</span>, <span class=\"hljs-string\">'is'</span> =&gt; <span class=\"hljs-keyword\">new</span> Zend_Db_Expr(<span class=\"hljs-string\">'not null'</span>)),\n                <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'attribute'</span> =&gt; <span class=\"hljs-string\">'news_to_date'</span>, <span class=\"hljs-string\">'is'</span>   =&gt; <span class=\"hljs-keyword\">new</span> Zend_Db_Expr(<span class=\"hljs-string\">'not null'</span>))\n            ))\n            -&gt;addAttributeToSort(<span class=\"hljs-string\">'news_from_date'</span>, <span class=\"hljs-string\">'desc'</span>)\n            -&gt;setPageSize(<span class=\"hljs-keyword\">$this</span>-&gt;getProductsCount())\n            -&gt;setCurPage(<span class=\"hljs-number\">1</span>);\n    }\n}\n</code></pre>\n<p>далее немного объяснений... Дату обязательно берем с помощью функций Magento, поскольку в ней (в Magento) можно выбирать часовой пояс независимо от настроек на сервере (в базе Magento хранит все даты в GTM формате). Дальше добавляем фильтры на атрибуты <strong>news_from_date</strong> и <strong>news_to_date</strong>. Проверка работает следующим образом: если установлен &quot;дата с&quot; которой продукт &quot;новый&quot; - она больше равна сегодня или не установлена, потом проверяется &quot;дата до&quot; - она меньше равна сегодня или не установлена и потом проверяется чтобы хотя б один из атрибутов был установлен. Сортировка установлена по &quot;дате с&quot; в обратном порядке. Только такие продукты выбираются. Кстати, 3 параметр в методе <strong>addAttributeToFilter</strong> означает тип джойна для таблиц в запросе.</p>\n<h4 id=\"poslednie\"><a name=\"poslednie\" class=\"h-link\" href=\"#\"></a>Последние</h4>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getLastProducts</span><span class=\"hljs-params\">()</span>\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;getProductCollection()\n            -&gt;setOrder(<span class=\"hljs-string\">'entity_id'</span>, <span class=\"hljs-string\">'desc'</span>)\n            -&gt;setCurPage(<span class=\"hljs-number\">1</span>)\n            -&gt;setPageSize(<span class=\"hljs-keyword\">$this</span>-&gt;getProductsCount());\n    }\n}\n</code></pre>\n<p>Тут то объяснять нечего. Берем продукты сортируем по идентификатору в обратном порядке.</p>\n<h4 id=\"specz-predlozheniya\"><a name=\"specz-predlozheniya\" class=\"h-link\" href=\"#\"></a>Спец. предложения</h4>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getSpecialProducts</span><span class=\"hljs-params\">()</span>\n    </span>{\n        $date = Mage::getModel(<span class=\"hljs-string\">'core/date'</span>);\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;getProductCollection()\n            -&gt;addAttributeToSort(<span class=\"hljs-string\">'special_from_date'</span>,<span class=\"hljs-string\">'desc'</span>)\n            -&gt;addAttributeToFilter(<span class=\"hljs-string\">'special_from_date'</span>, <span class=\"hljs-keyword\">array</span>(\n                <span class=\"hljs-string\">'date'</span> =&gt; <span class=\"hljs-keyword\">true</span>, <span class=\"hljs-string\">'to'</span> =&gt; $date-&gt;date()\n            ))\n            -&gt;addAttributeToFilter(<span class=\"hljs-string\">'special_to_date'</span>, <span class=\"hljs-keyword\">array</span>( <span class=\"hljs-string\">'or'</span> =&gt; <span class=\"hljs-keyword\">array</span>(\n                <span class=\"hljs-number\">0</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'date'</span> =&gt; <span class=\"hljs-keyword\">true</span>, <span class=\"hljs-string\">'from'</span> =&gt; $date-&gt;timestamp() + <span class=\"hljs-number\">86400</span>), <span class=\"hljs-comment\">// tomorrow date</span>\n                <span class=\"hljs-number\">1</span> =&gt; <span class=\"hljs-keyword\">array</span>(<span class=\"hljs-string\">'is'</span>   =&gt; <span class=\"hljs-keyword\">new</span> Zend_Db_Expr(<span class=\"hljs-string\">'null'</span>)))\n            ), <span class=\"hljs-string\">'left'</span>)\n            -&gt;setCurPage(<span class=\"hljs-number\">1</span>)\n            -&gt;setPageSize(<span class=\"hljs-keyword\">$this</span>-&gt;getProductsCount());\n    }\n}\n</code></pre>\n<p>Код работает по аналогии к новым продуктам.</p>\n<h4 id=\"produkty-s-opredelennym-flagom\"><a name=\"produkty-s-opredelennym-flagom\" class=\"h-link\" href=\"#\"></a>Продукты с определенным флагом</h4>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Freaks_Products_Block_Region</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Mage_Catalog_Block_Product_Abstract</span>\n</span>{\n    <span class=\"hljs-comment\">// some another methods</span>\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFlaggedProducts</span><span class=\"hljs-params\">($flagName, $flagValue = <span class=\"hljs-number\">1</span>)</span>\n    </span>{\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">$this</span>-&gt;getProductCollection()\n            -&gt;addAttributeToFilter($flagName, $flagValue)\n            -&gt;addAttributeToSort(<span class=\"hljs-keyword\">$this</span>-&gt;getFlaggedSortBy());\n    }\n\n    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getFlaggedSortBy</span><span class=\"hljs-params\">()</span>\n    </span>{\n        $sortBy = <span class=\"hljs-keyword\">$this</span>-&gt;getData(<span class=\"hljs-string\">'flagged_sort_by'</span>);\n        <span class=\"hljs-keyword\">if</span> (!$sortBy) {\n            $sortBy = <span class=\"hljs-string\">'entity_id'</span>;\n        }\n        <span class=\"hljs-keyword\">return</span> $sortBy;\n    }\n}\n</code></pre>\n<p>При помощи метода <strong>setFlaggedSortBy</strong> можно установить порядок сортировки для продуктов с определенным флагом на уровне темы, т.е. в layout-update файлах.</p>\n<h2 id=\"ispolzuem-na-praktike\"><a name=\"ispolzuem-na-praktike\" class=\"h-link\" href=\"#\"></a>Используем на практике</h2>\n<p>Допустим нужно вывести все типы таких блоков на главной странице. Тогда в layout-update пишем</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\"?&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">layout</span> <span class=\"hljs-attr\">version</span>=<span class=\"hljs-string\">\"0.1.0\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms_index_index</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">reference</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"content\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"freaks_products/region\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"products.new\"</span> <span class=\"hljs-attr\">template</span>=<span class=\"hljs-string\">\"freaks/products.phtml\"</span> <span class=\"hljs-attr\">before</span>=<span class=\"hljs-string\">\"-\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setType\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>new<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setProductsCount\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">limit</span>&gt;</span>5<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">limit</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"freaks_products/region\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"products.special\"</span> <span class=\"hljs-attr\">template</span>=<span class=\"hljs-string\">\"freaks/products.phtml\"</span> <span class=\"hljs-attr\">after</span>=<span class=\"hljs-string\">\"products.new\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setType\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>special<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setProductsCount\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">limit</span>&gt;</span>3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">limit</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"freaks_products/region\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"products.last\"</span> <span class=\"hljs-attr\">template</span>=<span class=\"hljs-string\">\"freaks/products.phtml\"</span> <span class=\"hljs-attr\">after</span>=<span class=\"hljs-string\">\"products.special\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setType\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>last<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setProductsCount\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">limit</span>&gt;</span>2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">limit</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"freaks_products/region\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"products.featured\"</span> <span class=\"hljs-attr\">template</span>=<span class=\"hljs-string\">\"freaks/featured_products.phtml\"</span> <span class=\"hljs-attr\">after</span>=<span class=\"hljs-string\">\"products.last\"</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span> <span class=\"hljs-attr\">method</span>=<span class=\"hljs-string\">\"setProductsCount\"</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">limit</span>&gt;</span>10<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">limit</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">reference</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms_index_index</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">layout</span>&gt;</span>\n</code></pre>\n<p>Исходники можно скачать <a href=\"/media/assets/Freaks_Products.zip\" download=\"Freaks_Products.zip\">здесь</a></p>\n<p><strong>P.S.</strong>: в следующей статье опишу как создавать страницы разных типов с возможностями layered navigation</p>","headings":[["bloki-kirpichik-k-kirpichiku","Блоки. Кирпичик к кирпичику"],["novinki","Новинки"],["poslednie","Последние"],["specz-predlozheniya","Спец. предложения"],["produkty-s-opredelennym-flagom","Продукты с определенным флагом"],["ispolzuem-na-praktike","Используем на практике"]],"id":"bloki-kak-vyvesti-spisok-vsekh-novinok-ili-spets-predlozhenii-v-magento"}