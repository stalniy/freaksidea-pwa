{"title":"Magento конфигурация от А до Я: базовые настройки модуля","summary":"Magento, как и любая другая современная система, состоит из модулей. Понятно,\nчто любой модуль имеет свои настройки. По-этому для написания дополнительного\nфункционала стоит разораться с их форматом в Magento.\n","author":"sstotskyi","categories":["backend","important"],"createdAt":"2011-11-04T00:20:00.000Z","meta":{"keywords":["magento","модуль","конфигурация"]},"alias":"magento-konfiguratsiia-ot-a-do-ya-bazovye-nastrojki-modulia","content":"<p><em>Magento</em>, как и любая другая современная система, состоит из модулей. Понятно, что любой модуль имеет свои настройки. По-этому для написания дополнительного функционала стоит разораться с их форматом в <em>Magento</em>.</p>\n<p>В <em>Magento</em> основная часть конфигурации модуля находится в файле  <em>etc</em>/<em>config.xml</em>. Для оптимизации загрузки модуля, часть конфигурации можно вынести в <em>adminhtml.xml</em>, но об этом позже.</p>\n<h2 id=\"struktura-konfiguraczii-modulya\"><a name=\"struktura-konfiguraczii-modulya\" class=\"h-link\" href=\"#\"></a>Структура конфигурации модуля</h2>\n<p>Любая конфигурация модуля состоит из корневого элемента <em>config</em> (заголовок <em>XML</em>-я необязательный) и нескольких базовых секций: <em>modules</em>, <em>frontend</em>, <em>adminhtml</em>, <em>global</em>, <em>admin</em>, <em>default</em>, <em>crontab</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">config</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modules</span>&gt;</span>.................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modules</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">frontend</span>&gt;</span>................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">frontend</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">adminhtml</span>&gt;</span>...............<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">adminhtml</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">global</span>&gt;</span>..................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">global</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">default</span>&gt;</span>.................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">default</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">crontab</span>&gt;</span>.................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">crontab</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">admin</span>&gt;</span>...................<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">admin</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">config</span>&gt;</span>\n</code></pre>\n<p>В секции <em>modules</em> находится информация об имени и версии модуля, в случае <em>Mage_Cms</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Mage_Cms</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.7.13<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Mage_Cms</span>&gt;</span>\n</code></pre>\n<p>Секция <em>frontend</em> задает настройки модуля для фронта (т.е. сайта): настройка роутинга, обсерверов событий, переводов и <em>layout-update</em>-ов.</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">frontend</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">routers</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">use</span>&gt;</span>standard<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">use</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">args</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">module</span>&gt;</span>Mage_Cms<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">module</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">frontName</span>&gt;</span>cms<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">frontName</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">args</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">routers</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">events</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">controller_action_noroute</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">observers</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>cms/observer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">method</span>&gt;</span>noRoute<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">method</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">observers</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">controller_action_noroute</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">controller_action_nocookies</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">observers</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>cms/observer<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">method</span>&gt;</span>noCookies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">method</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">observers</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">controller_action_nocookies</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">events</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">translate</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modules</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">Mage_Cms</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">files</span>&gt;</span>\n          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">default</span>&gt;</span>Mage_Cms.csv<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">default</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">files</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">Mage_Cms</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modules</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">translate</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">layout</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">updates</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">file</span>&gt;</span>cms.xml<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">file</span>&gt;</span>\n      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">updates</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">layout</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">frontend</span>&gt;</span>\n</code></pre>\n<p>В секции <em>routers</em> указываем, какие запросы будут обрабатываться контроллерами данного модуля. Каждое правило роутинга имеет свое имя, оно задается в качестве имени первого тега, в данном случае - <em><cms></em>, т.е. имя - <strong>cms</strong>. Тег <strong>use</strong> задает, какую модель роутера использовать в данном случае используем стандартный. Для его инициализации нужно передать аргументы и это можно сделать при помощи тега <strong>args</strong>. Для стандартного роутера нужно передать имя модуля и префикс запроса - <strong>frontName</strong>. Теперь все запросы по адресу <em>http://BASE_URL/cms/*</em> будут обрабатываться контроллерами модуля <strong>Mage_CMS</strong>.</p>\n<p>В секции <strong>events</strong> задаем настройки для обсерверов. Имя любого дочернего тега в секции <em>events</em> является названием события в <em>Magento</em>. В случае с модулем <em>Mage_Cms</em> указываем, что при возникновении события <em>controller_action_noroute</em> нужно вызвать метод <strong>noRoute</strong> модели <em>cms/observer</em>. Благодаря этому, в административном интерфейсе существует возможность создать собственную страницу и приаттачить ее на  <a href=\"http://uk.wikipedia.org/wiki/HTTP_404\" target=\"_blank\" rel=\"noopener nofollow\">404 HTTP</a> ошибку.</p>\n<p>В секции <em>translate</em> можно указать название файла для локализации (в <em>Magento</em> для этого используются <a href=\"http://ru.wikipedia.org/wiki/CSV\" target=\"_blank\" rel=\"noopener nofollow\">csv файлы</a>).</p>\n<p>В секции <em>layout</em> можно указать файл, в котором прописаны настройки для <app-link to=\"backend\" params=\"{&quot;id&quot;:&quot;magento-konfighuratsiia-ot-a-do-ia-layout-updates&quot;}\">layout-update-ов</app-link>.</p>\n<p>Для секции <em>adminhtml</em> справедливо все то, что и для <em>frontend</em>. Разница только в том, что эти настройки будут применяться для административной части, а не для фронта. Чтобы файл <em>config.xml</em> не был слишком большим (что замедляет его загрузку и разбор <strong>xml</strong>), все директивы относящиеся к секции <em>adminhtml</em> (т.е. к административному интерфейсу) можно вынести в отдельный файл - <em>adminhtml.xml</em>. Именно так и сделано в модуле <strong>Mage_Cms</strong></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">config</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">menu</span>&gt;</span>.....<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">menu</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">acl</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resources</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">admin</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">children</span>&gt;</span>....<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">children</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">admin</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resources</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">acl</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">config</span>&gt;</span>\n</code></pre>\n<p>Конфигурация обычно состоит из 2 секций: <em>menu</em> и <em>acl</em>, но также можно указывать и другие директивы (например, <em>events</em>, <em>layout-update</em> и т.д.). Первая отвечает за добавление новых элементов в меню административной части, а вторая - за права доступа, т.е. <a href=\"http://ru.wikipedia.org/wiki/ACL\" target=\"_blank\" rel=\"noopener nofollow\">ACL</a>. Рассмотрим секцию <em>menu</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span> <span class=\"hljs-attr\">module</span>=<span class=\"hljs-string\">\"cms\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>CMS<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>70<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">children</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">page</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span> <span class=\"hljs-attr\">module</span>=<span class=\"hljs-string\">\"cms\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Pages<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span>&gt;</span>adminhtml/cms_page<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">page</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span> <span class=\"hljs-attr\">module</span>=<span class=\"hljs-string\">\"cms\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Static Blocks<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">action</span>&gt;</span>adminhtml/cms_block<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">action</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>10<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">children</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n</code></pre>\n<p>Чтобы добавить новый элемент меню нужно указать: <em>title</em>, <em>action</em> и <em>sort_order</em>. Атрибут <em>translate</em> указывает, содержимое какого тега нужно переводить, нужно указывать для каждого элемента меню. Атрибут <em>module</em> указывает используемый модуль, не смотря на то, что он указан для каждого тега, его можно задать только для верхнего родительского элемента (в данном случае <strong>cms</strong>), для остальных он пронаследуется.</p>\n<p>Тег <em>action</em> указывает на модель контроллера. Например, <em>adminhtml/cms_page</em> - <strong>Mage_Adminhtml_Cms_PageController</strong>.</p>\n<p>Перейдем к секции <em>acl</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span> <span class=\"hljs-attr\">module</span>=<span class=\"hljs-string\">\"cms\"</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>CMS<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>70<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">children</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Static Blocks<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>10<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">page</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Pages<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">children</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">save</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Save Page<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">save</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Delete Page<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>10<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">children</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">page</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">media_gallery</span> <span class=\"hljs-attr\">translate</span>=<span class=\"hljs-string\">\"title\"</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>Media Gallery<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sort_order</span>&gt;</span>20<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sort_order</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">media_gallery</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">children</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n</code></pre>\n<p>В <em>ACL</em> можно задать структуру для возможности изменения прав доступа в административной панели (<strong>System</strong> -&gt; <strong>Permissions</strong> -&gt; <em>Выбрать роль</em> -&gt; <strong>Role Resources</strong> -&gt; <strong>Custom</strong>). Потом проверить имеет ли пользователь права на определенные действия можно при помощи конструкции</p>\n<pre><code class=\"hljs language-php\">Mage::getSingleton(<span class=\"hljs-string\">'admin/session'</span>)-&gt;isAllowed(<span class=\"hljs-string\">'cms/page/save'</span>);\n</code></pre>\n<p>А в контроллере при помощи метода <strong>_isAllowed</strong> (пример взят из <em>Mage_Adminhtml_Cms_PageController</em> класса)</p>\n<pre><code class=\"hljs language-php\"><span class=\"hljs-comment\">/**\n * Check the permission to run it\n *\n * <span class=\"hljs-doctag\">@return</span> boolean\n */</span>\n<span class=\"hljs-keyword\">protected</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">_isAllowed</span><span class=\"hljs-params\">()</span>\n</span>{\n    <span class=\"hljs-keyword\">switch</span> (<span class=\"hljs-keyword\">$this</span>-&gt;getRequest()-&gt;getActionName()) {\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">'new'</span>:\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">'save'</span>:\n            <span class=\"hljs-keyword\">return</span> Mage::getSingleton(<span class=\"hljs-string\">'admin/session'</span>)-&gt;isAllowed(<span class=\"hljs-string\">'cms/page/save'</span>);\n            <span class=\"hljs-keyword\">break</span>;\n        <span class=\"hljs-keyword\">case</span> <span class=\"hljs-string\">'delete'</span>:\n            <span class=\"hljs-keyword\">return</span> Mage::getSingleton(<span class=\"hljs-string\">'admin/session'</span>)-&gt;isAllowed(<span class=\"hljs-string\">'cms/page/delete'</span>);\n            <span class=\"hljs-keyword\">break</span>;\n        <span class=\"hljs-keyword\">default</span>:\n            <span class=\"hljs-keyword\">return</span> Mage::getSingleton(<span class=\"hljs-string\">'admin/session'</span>)-&gt;isAllowed(<span class=\"hljs-string\">'cms/page'</span>);\n            <span class=\"hljs-keyword\">break</span>;\n    }\n}\n</code></pre>\n<p>Будьте внимательны в файле <em>adminhtml.xml</em> можно задавать только права доступа (<em>acl</em>) и добавлять новые элементы меню!</p>\n<p>В секции <em>global</em> можно задавать тоже самое, что и в секции <em>frontend</em>. Директивы из этой секции будут применяться, как для фронта, так и для административной части. Здесь в основном задаются префиксы для имен классов</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">blocks</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>Mage_Cms_Block<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">blocks</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">helpers</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>Mage_Cms_Helper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">helpers</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">models</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>Mage_Cms_Model<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">resourceModel</span>&gt;</span>cms_mysql4<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">resourceModel</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms_mysql4</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">class</span>&gt;</span>Mage_Cms_Model_Mysql4<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">class</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">entities</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">page</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span>&gt;</span>cms_page<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">page</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">page_store</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span>&gt;</span>cms_page_store<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">page_store</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span>&gt;</span>cms_block<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block_store</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span>&gt;</span>cms_block_store<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">block_store</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">entities</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms_mysql4</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">models</span>&gt;</span>\n</code></pre>\n<p>Когда <em>Magento</em> обрабатывает <em>layout-update</em>-ы и видит конструкцию</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">block</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"cms/block\"</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"cms_footer_links\"</span> <span class=\"hljs-attr\">before</span>=<span class=\"hljs-string\">\"footer_links\"</span> /&gt;</span>\n</code></pre>\n<p>То сначала она разбирает атрибут <em>type</em>, который указывает класс блока. <em>cms/block</em> - первая часть (до слэша) определяет модуль - <strong>Mage_Cms</strong>. Смотрим настройки данного модуля, находим содержимое <em>blocks/cms/class</em>, в данном случае <em>Mage_Cms_Block</em> и добавляем к нему вторую часть от атрибута <em>type</em> (после слэша, в данном случае <strong>block</strong>) и получаем имя класса <strong>Mage_Cms_Block_Block</strong>. Аналогично все происходит для моделей и хелперов.</p>\n<p>Бизнес модель связана с ресурс моделью при помощи тега <em>models/cms/resourceModel</em>, в котором хранится имя другого тега, отвечающего за конфигурацию последней. В данном случае - это тег <strong>cms_mysql4</strong>. В теге <em>models/cms/cms_mysql4/entities</em> указываются имена и элиасы таблиц в базе данных, доступ к которым можно получить в ресурс модели при помощи конструкции</p>\n<pre><code class=\"hljs language-php\">$blocksTable = <span class=\"hljs-keyword\">$this</span>-&gt;getTable(<span class=\"hljs-string\">'cms/block'</span>); <span class=\"hljs-comment\"># cms_block</span>\n</code></pre>\n<p>В данном случае метод смотрит конфигурацию модуля (<em>models/cms_mysql4/entities/block/table</em>) и возвращает его контент. Если такого тега не существует, то возвращается передаваемая строка. По-этому рекомендуется обращаться к имени таблицы именно таким методом, а не хардкодить или писать, что-то вроде</p>\n<pre><code class=\"hljs language-php\">$blocksTable = <span class=\"hljs-keyword\">$this</span>-&gt;getTable(<span class=\"hljs-string\">'cms_block'</span>);\n</code></pre>\n<p>потому что это неправильно!</p>\n<p>В секции <em>default</em> можно прописать настройки по умолчанию для <em>Magento</em>, именно те, которые можно редактировать в <strong>System</strong> -&gt; <strong>Configuration</strong>. Например, часть секции из модуля <em>Mage_Cms</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">default</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cms</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">wysiwyg</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">enabled</span>&gt;</span>enabled<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">enabled</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">wysiwyg</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cms</span>&gt;</span>\n\n    <span class=\"hljs-comment\">&lt;!-- another configs --&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">default</span>&gt;</span>\n</code></pre>\n<p>указывает, что по умолчанию <a href=\"http://ru.wikipedia.org/wiki/WYSIWYG\" target=\"_blank\" rel=\"noopener nofollow\">WYSIWYG</a> редактор включен.</p>\n<p>В секции <em>crontab</em> можно создать задание, которое выполнится через крон в <em>Magento</em>. Информация о всех заданиях крона хранится в таблице <em>cron_schedule</em>. Рассмотрим пример из модуля <em>Mage_Newsletter</em></p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">crontab</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">jobs</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">newsletter_send_all</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">schedule</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">cron_expr</span>&gt;</span>*/5 * * * *<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">cron_expr</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">schedule</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">run</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">model</span>&gt;</span>newsletter/observer::scheduledSend<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">model</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">run</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">newsletter_send_all</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">jobs</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">crontab</span>&gt;</span>\n</code></pre>\n<p>Имена всех дочерних тегов секции <em>crontab/jobs</em> являются именами заданий в таблице крона и хранятся в поле <em>job_code</em>. В данном случае задача называется <strong>newsletter_send_all</strong>. В секции <em>schedule/cron_expr</em> задается периодичность выполнения задания, в данном случае каждые 5 минут. Формат похож на тот, который используется в <a href=\"http://ru.wikipedia.org/wiki/Cron\" target=\"_blank\" rel=\"noopener nofollow\">Linux cron табе</a>. В директиве <em>run/model</em> задается модель (<em>newsletter/observer</em>) и метод, который нужно запустить в определенное время (<em>scheduledSend</em>).</p>\n<p>Последняя секции <em>admin</em> - в основном здесь прописываются правила роутинга для административной панели</p>\n<pre><code class=\"hljs language-xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">admin</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">routers</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">adminhtml</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">args</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modules</span>&gt;</span>\n                    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">importexport</span> <span class=\"hljs-attr\">before</span>=<span class=\"hljs-string\">\"Mage_Adminhtml\"</span>&gt;</span>Mage_ImportExport_Adminhtml<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">importexport</span>&gt;</span>\n                <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modules</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">args</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">adminhtml</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">routers</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">admin</span>&gt;</span>\n</code></pre>\n<h2 id=\"na-posledok\"><a name=\"na-posledok\" class=\"h-link\" href=\"#\"></a>На последок</h2>\n<p>В файле конфигурации также могут быть и нестандартные теги. Например, в модуле <em>Mage_ImportExport</em> есть секция <em>global/importexport</em>. Доступ к нестандартным настройкам можно получить при помощи конструкции</p>\n<pre><code class=\"hljs language-php\">$dataArray = Mage::getConfig()-&gt;getNode(<span class=\"hljs-string\">'global/importexport'</span>)-&gt;asCanonicalArray();\n</code></pre>","headings":[["struktura-konfiguraczii-modulya","Структура конфигурации модуля"],["na-posledok","На последок"]],"id":"magento-konfighuratsiia-ot-a-do-ia-bazovye-nastroiki-modulia"}